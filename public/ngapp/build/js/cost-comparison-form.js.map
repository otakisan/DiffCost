{"version":3,"sources":["../../js/cost-comparison-form.js"],"names":[],"mappings":"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","file":"cost-comparison-form.js","sourcesContent":["(function () {\n\tangular.module('costComparisonFormApp', [])\n\t\t.directive('costComparisonForm', function () {\n\t\t// templateUrlは、ディレクティブを呼び出しているページからの相対パス\n\t\t// ルートからの相対パスにして、どこからでも使えるようにする\n\t\treturn {\n\t\t\trestrict: 'E',\n\t\t\ttemplateUrl: '/ngapp/partials/cost-comparison-form.html',\n\t\t\tcontroller: ['$http', function ($http) {\n\t\t\t\t// ケアレスミスを防ぐため、最初にthisを移し替えることをルールとしたほうがいいのかも\n\t\t\t\tvar thisController = this;\n\t\t\t\n\t\t\t\t// ユーザーをひも付ける情報は、railsのidとアプリのidとどちらがよいか\n\t\t\t\t// データベースの移行を考えると、連番よりも固有のアカウントIDのほうがよさそうに感じる\n\t\t\t\t// API越しに関連付ける際、デフォルトのUser.idではなく、User.user_idとひも付ける\n\t\t\t\tthisController.pageTitleDefault = \"見積・実績比較\";\n\t\t\t\tthisController.pageTitle = thisController.pageTitleDefault;\n\t\t\t\tthisController.projects = [];\n\t\t\t\tthisController.costComparisonResult = {};\n\t\t\t\tthisController.userId = \"\";\n\t\t\t\tthisController.waiting = false;\n\t\t\t\tthisController.csvUrl = \"\";\n\t\t\t\tthisController.quotationsTerm = {start: \"\", end: \"\"};\n\t\t\t\n\t\t\t\t// プロジェクトの種類を取得\n\t\t\t\t$http.get('/quotations/projects/index.json').success(function (data) {\n\t\t\t\t\tthisController.projects = data;\n\t\t\t\t\tthisController.selectedProject = thisController.projects[0].project_name;\n\t\t\t\t\tthisController.changedSelectedProject();\n\t\t\t\t});\n\t\t\t\n\t\t\t\t// プロパティもメソッドも全部定義するから、中身が膨れやすい\n\t\t\t\tthis.submitForm = function () {\n\t\t\t\t\tthisController.pageTitle = \"取得中... : \";\n\n\t\t\t\t\t// データを取得\n\t\t\t\t\tthisController.waiting = true;\n\t\t\t\t\tvar project_name_encoded = encodeURIComponent(thisController.selectedProject);\n\t\t\t\t\t$http.get(\"/cost_comparisons/\" + project_name_encoded + \".json\")\n\t\t\t\t\t\t.success(function (data, status, headers, config) {\n\t\t\t\t\t\t// タイトルを元に戻し、データを保持\n\t\t\t\t\t\tthisController.pageTitle = thisController.pageTitleDefault;\n\t\t\t\t\t\tthisController.costComparisonResult = data;\n\t\t\t\t\t\tthisController.waiting = false;\n\t\t\t\t\t})\n\t\t\t\t\t\t.error(function (data, status, headers, config) {\n\t\t\t\t\t\tthisController.pageTitle = \"取得失敗\";\n\t\t\t\t\t\tthisController.costComparisonResult = data;\n\t\t\t\t\t\tthisController.waiting = false;\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\t// TODO: 画面のラベルに表示する文字列はコントローラーの責務でないように思えるが、一旦実装する\n\t\t\t\tthis.getQuotationTermText = function() {\n\t\t\t\t\treturn this.getTermText(this.costComparisonResult.quotations);\n\t\t\t\t};\n\n\t\t\t\tthis.getFactTermText = function() {\n\t\t\t\t\treturn this.getTermText(this.costComparisonResult.facts);\n\t\t\t\t};\n\n\t\t\t\tthis.getTermText = function(dataArray) {\n\t\t\t\t\tvar quotationTermText = \"\";\n\t\t\t\t\tif (dataArray && dataArray.length > 0) {\n\t\t\t\t\t\t// 分単位で表示（対応ブラウザのみ）\n\t\t\t\t\t\tvar options = { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' };\n\t\t\t\t\t\tquotationTermText = new Date(dataArray[0].updated_at).toLocaleString('ja-JP', options).replace(\"JST\", \"\") + \" 〜 \"\n\t\t\t\t\t\t+ new Date(dataArray[dataArray.length - 1].updated_at).toLocaleString('ja-JP', options).replace(\"JST\", \"\");\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn quotationTermText;\n\t\t\t\t};\n\n\t\t\t\tthis.getProjectNameText = function() {\n\t\t\t\t\tvar dataArray = this.costComparisonResult.quotations || this.costComparisonResult.facts;\n\t\t\t\t\treturn dataArray && dataArray.length > 0 ? dataArray[0].project_name : \"\";\n\t\t\t\t};\n\n\t\t\t\tthis.getTotalManDayText = function() {\n\t\t\t\t\tvar mandayQ = this.getTotalManDayOfQuotations();\n\t\t\t\t\tvar mandayF = this.getTotalManDayOfFacts();\n\t\t\t\t\treturn !mandayQ && !mandayF ? \"\" : `見積：${mandayQ}\b／ 実績：${mandayF}`;\n\t\t\t\t};\n\n\t\t\t\tthis.getTotalManDayOfQuotations = function() {\n\t\t\t\t\treturn this.getTotalManDay(this.costComparisonResult.quotations);\n\t\t\t\t};\n\n\t\t\t\tthis.getTotalManDayOfFacts = function() {\n\t\t\t\t\treturn this.getTotalManDay(this.costComparisonResult.facts);\n\t\t\t\t};\n\n\t\t\t\tthis.getTotalManDay = function(array) {\n\t\t\t\t\t// TODO: 小数点の扱い 見た目上の合計と差異が出る 12.9 <=> 12.89999...\n\t\t\t\t\treturn !array ? \"\" : array.reduce( (prevValue, currentValue) => prevValue + currentValue.man_day, 0);\n\t\t\t\t};\n\n\t\t\t\tthis.getPostData = function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'url': '/cost-comparisons.json',\n\t\t\t\t\t\t'params': thisController.getPostParams()\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tthis.getPostParams = function () {\n\t\t\t\t\tvar postParam = {\n\t\t\t\t\t\t'project_name': thisController.selectedProject,\n\t\t\t\t\t\t'user_id': thisController.userTableId\n\t\t\t\t\t};\n\n\t\t\t\t\treturn postParam;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tthis.downloadCsv = function () {\n\t\t\t\t\tthisController.pageTitle = \"CSV取得中... : \";\n\t\t\t\t\n\t\t\t\t\t// 実績比較表取得のためのデータを取得\n\t\t\t\t\t//var postData = thisController.getPostData();\n\t\t\t\t\n\t\t\t\t\t// 取得\n\t\t\t\t\t// TODO:どういうリクエストを送ればいい？\n\t\t\t\t\tthisController.waiting = true;\n\t\t\t\t\tvar project_name_encoded = encodeURIComponent(thisController.selectedProject);\n\t\t\t\t\t$http.get(\"/cost_comparisons/download/\" + project_name_encoded + \".csv\")\n\t\t\t\t\t\t.success(function (data, status, headers, config) {\n\t\t\t\t\t\tthisController.pageTitle = \"取得完了\";\n\t\t\t\t\t\tthisController.waiting = false;\n\t\t\t\t\t})\n\t\t\t\t\t\t.error(function (data, status, headers, config) {\n\t\t\t\t\t\tthisController.pageTitle = \"取得失敗\";\n\t\t\t\t\t\tthisController.waiting = false;\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tthis.changedSelectedProject = function () {\n\t\t\t\t\tvar project_name_encoded = encodeURIComponent(thisController.selectedProject);\n\t\t\t\t\tthisController.csvUrl = \"/cost_comparisons/download/\" + project_name_encoded + \".csv\";\n\t\t\t\t};\n\t\t\t}],\n\t\t\tcontrollerAs: 'costComparison'\n\t\t};\n\t});\n})();"]}