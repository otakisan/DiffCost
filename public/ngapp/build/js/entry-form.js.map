{"version":3,"sources":["../../js/entry-form.js"],"names":[],"mappings":"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","file":"entry-form.js","sourcesContent":["(function () {\n\tangular.module('entryFormApp', [])\n\t\t.directive('entryForm', function () {\n\t\t// templateUrlは、ディレクティブを呼び出しているページからの相対パス\n\t\t// ルートからの相対パスにして、どこからでも使えるようにする\n\t\treturn {\n\t\t\trestrict: 'E',\n\t\t\ttemplateUrl: '/ngapp/partials/entry-form.html',\n\t\t\tcontroller: ['$http', function ($http) {\n\t\t\t\t// ケアレスミスを防ぐため、最初にthisを移し替えることをルールとしたほうがいいのかも\n\t\t\t\tvar thisController = this;\n\t\t\t\n\t\t\t\t// ユーザーをひも付ける情報は、railsのidとアプリのidとどちらがよいか\n\t\t\t\t// データベースの移行を考えると、連番よりも固有のアカウントIDのほうがよさそうに感じる\n\t\t\t\t// API越しに関連付ける際、デフォルトのUser.idではなく、User.user_idとひも付ける\n\t\t\t\tthisController.appTitle = \"見積・実績\";\n\t\t\t\tthisController.pageTitle = \"入力ページ(兼トップページ)\";\n\t\t\t\tthisController.userText = \"\";\n\t\t\t\tthisController.userTableId = 0;\n\t\t\t\tthisController.userId = \"\";\n\t\t\t\tthisController.entityTargets = [\n\t\t\t\t\t{\n\t\t\t\t\t\t'name': '見積',\n\t\t\t\t\t\t'value': 'quotation'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t'name': '実績',\n\t\t\t\t\t\t'value': 'fact'\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t\tthisController.entityTarget = thisController.entityTargets[0].value;\n\t\t\t\n\t\t\t\t// 通信がからむときの実行順が気になる。ここに限らずだけど。\n\t\t\t\t// TODO: ユーザー固定の仕様だが、特定ユーザーを検索する形にし、存在しなければ登録できないようにするか\n\t\t\t\t$http.get('/users/1.json').success(function (data) {\n\t\t\t\t\tthisController.userTableId = data.id;\n\t\t\t\t\tthisController.userId = data.user_id;\n\t\t\t\t});\n\t\t\t\n\t\t\t\t// プロパティもメソッドも全部定義するから、中身が膨れやすい\n\t\t\t\tthis.submitForm = function () {\n\t\t\t\t\tthisController.pageTitle = \"登録中... : \" + thisController.userText;\n\t\t\t\t\n\t\t\t\t\t// 選択したエンティティ向けのパラメータを作成\n\t\t\t\t\tvar postData = thisController.getPostData();\n\t\t\t\t\n\t\t\t\t\t// 登録\n\t\t\t\t\t$http.post(postData.url, postData.params)\n\t\t\t\t\t\t.success(function (data, status, headers, config) {\n\t\t\t\t\t\tthisController.pageTitle = \"登録完了 ID：\" + data.id;\n\t\t\t\t\t\tthisController.userText = \"\";\n\t\t\t\t\t})\n\t\t\t\t\t\t.error(function (data, status, headers, config) {\n\t\t\t\t\t\tthisController.pageTitle = \"登録失敗\";\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tthis.getPostData = function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'url': '/' + thisController.entityTarget + 's.json',\n\t\t\t\t\t\t'params': thisController.getPostParams()\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tthis.getPostParams = function () {\n\t\t\t\t\tvar textPropName = thisController.entityTarget + '_text';\n\t\t\t\t\tvar projectNameAndText = thisController.splitProjectNameAndText();\n\t\t\t\t\tvar postParam = {\n\t\t\t\t\t\t'project_name': projectNameAndText.project_name,\n\t\t\t\t\t\t'user_id': thisController.userTableId,\n\t\t\t\t\t\t'man_day': projectNameAndText.man_day\n\t\t\t\t\t};\n\t\t\t\t\tpostParam[textPropName] = projectNameAndText.text;\n\n\t\t\t\t\treturn postParam;\n\t\t\t\t};\n\n\t\t\t\tthis.splitProjectNameAndText = function () {\n\t\t\t\t\t// Javascriptでは、後読みがサポートされていない\n\t\t\t\t\t// #始まりはプロジェクト案件名、空白で区切って、以降は全て内容とする\n\t\t\t\t\tvar re = /(^#.+?(?=\\s+))?(.+)/g;\n\t\t\t\t\tvar matchArray = re.exec(thisController.userText.trim());\n\n\t\t\t\t\tvar manDay = \"\";\n\t\t\t\t\tvar text = matchArray[2].trim();\n\t\t\t\t\tvar manDayMatch = /\\b([0-9][0-9\\.]*)(?=人日)/g.exec(matchArray[2]);\n\t\t\t\t\tif(manDayMatch){\n\t\t\t\t\t\tmanDay = manDayMatch[1];\n\t\t\t\t\t\tvar regex = new RegExp(`\\\\b${manDay}人日`);\n\t\t\t\t\t\ttext = matchArray[2].replace(regex, \"\").trim();\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t// よりシンプルな形で#を取り除く方法ってどんなものか\n\t\t\t\t\treturn {\n\t\t\t\t\t\t'text': text,\n\t\t\t\t\t\t'project_name': /^#(.*)/g.exec(matchArray[1] || '#')[1],\n\t\t\t\t\t\t'man_day': manDay\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t}],\n\t\t\tcontrollerAs: 'diffCost'\n\t\t};\n\t});\n})();"]}